<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>tm_h5_sdk test</title></head>
<body>
<div class="app"></div>
<pre id="login"></pre>
<button onclick="pay()" id="payButton" disabled="disabled">支付测试</button>
<pre id="pay"></pre>
<script src="index.js"></script>
</body>
<script>window.TMSDK.config({
    appid: "tm24b3208f8730fb4f",
    appKey: "62834041b96f11ec9e1cc968ca9ce661",
    programId: "62834041b96f11ec9e1cc968ca9ce661"
});
let open_id = '';

function pay() {
    /**
     * 微信支付
     */
    window.TMSDK.pay({
        coin: 1,//支付金额，单位角
        open_id: open_id,//用户open_id
        program_param: 'test',//参数
        goodsName: '测试商品',//商品名称
        zone: '无区服',//区服
        gameUid: '1234',//游戏id
        gameNickname: '张三'//游戏昵称
    })
        .then(function (data) {
            /**
             * {"err":0,"data":{"url":"weixin://dl/business/?t=8p6QkFvEo3v"},"msg":"请求成功"}
             */
            console.log('pay result', data.data);
            document.getElementById('pay').innerHTML = JSON.stringify(data.data);
            window.location.href = data.data.data.url;
        })
}

/**
 * 登录获取用户信息
 * code为空默认从使用浏览器参数中获取
 */
window.TMSDK.login({code: '41f9d3548da22318fdce9c9bab02770d'}).then(function (data) {
    /**
     * {
    "err": 0,
    "data": {
        "app_id": "wx89db9ff783f2bef9",
        "open_id": "o8H0J4w85lFcScYA3CkhG98WP7no_h5",
        "union_id": "",
        "nick_name": "曼曼的奶奶",
        "avatar_url": "https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83ercSfrLufUjyrRZdgMiaHicZgAzn4xjLhkOEDEJGg1iacvfQrqFYetoTjvzgGC1sDX0rIs7xSRMBD1iag/132",
        "gender": 2,
        "city": "",
        "province": "山东",
        "country": "中国",
        "language": "zh_CN",
        "gold": 0,
        "diamond": 0,
        "share_new": 0,
        "share_times": 1,
        "online_days": 65,
        "online_duration": 156490,
        "last_login_time": 1630665315,
        "login_times": 122,
        "from_scene": "1089",
        "from_code": "",
        "create_time": 1536272473,
        "recharged_times": 1,
        "recharged": 9800,
        "is_new": false,
        "login_province": "广东省",
        "login_city": "广州市",
        "login_district": "",
        "ofp": "85bf94d127bd23f8fe600d7b1cfb7cf7d86f3e38"
    },
    "msg": "请求成功"
}
     */
    console.log('login result', data.data.data)
    open_id = data.data.data.open_id;

    if (open_id) {
        document.getElementById('payButton').removeAttribute('disabled');
    }
    document.getElementById('login').innerHTML = JSON.stringify(data.data);


    window.TMSDK.identifyQuery({
        open_id
    })
        .then(function (identifyData) {
            //{"err":0,"data":{"result":true},"msg":"请求成功"}
            console.log('identifyQuery result', JSON.stringify(identifyData.data));
            if (!identifyData.data.data.result) {
                /**
                 * 游戏上线上报
                 */
                window.TMSDK.identifyReport({
                    open_id
                })
                    .then(function (identifyData) {
                        console.log('identifyReport report', identifyData.data)
                    })
            } else {
                /**
                 *
                 */
                window.TMSDK.identify({
                    open_id,
                    name: "张竹英",
                    id_card: "530127196201170441"
                })
                    .then(function (identifyData) {
                        console.log('identify result', JSON.stringify(identifyData.data))
                    })
            }

        })

});</script>
</html>